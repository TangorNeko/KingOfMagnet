#pragma once
class DeferredRendering
{
private:
	DeferredRendering() = default;
	~DeferredRendering() = default;

	static DeferredRendering* m_instance;
public:
	/**
	 * @brief ディファードレンダリングクラスのインスタンスを作成
	*/
	static void CreateInstance()
	{
		if (!m_instance)
		{
			m_instance = new DeferredRendering;
		}
	}

	/**
	 * @brief ディファードレンダリングクラスのインスタンスを削除
	*/
	static void DeleteInstance()
	{
		delete m_instance;
		m_instance = nullptr;
	}

	/**
	 * @brief ディファードレンダリングクラスのインスタンスを取得
	 * @return インスタンスのポインタ
	*/
	static DeferredRendering* GetInstance() { return m_instance; }


	/**
	 * @brief G-Bufferと出力スプライトを作成
	*/
	void Init();

	/**
	 * @brief ディファードレンダリングの開始処理
	*/
	void StartDeferredRendering(RenderContext& rc);

	/**
	 * @brief ディファードレンダリングの終了処理
	*/
	void EndDeferredRendering(RenderContext& rc);

	/**
	 * @brief ディファードレンダリングの結果からライティングしたスプライトを描画
	 * @param rc レンダーコンテキスト
	*/
	void DrawDeferred(RenderContext& rc)
	{
		m_deferredSprite.Draw(rc);
	}

	/**
	 * @brief ディファードレンダリングに使用したデプスステンシルビューを取得
	 * @return デプスステンシルビュー
	*/
	D3D12_CPU_DESCRIPTOR_HANDLE GetDSVCpuDescriptorHandle()
	{
		return m_rts[0].GetDSVCpuDescriptorHandle();
	}

private:
	enum GBuffers						//追加されるテクスチャの種類
	{
		enAlbedo,						//アルベド
		enNormal,						//法線
		enWorldPos,						//ワールド座標
		enGBufferNum,					//G-Bufferの数
	};

	enum ShadowTextures
	{
		enShadowmap_Screen1_Near = 3,			//シャドウマップ(スクリーン1、近距離)
		enShadowmap_Screen1_Middle,			//シャドウマップ(スクリーン1、中距離)
		enShadowmap_Screen1_Far,			//シャドウマップ(スクリーン1、遠距離)
		enShadowmap_Screen2_Near,			//シャドウマップ(スクリーン2、近距離)
		enShadowmap_Screen2_Middle,			//シャドウマップ(スクリーン2、中距離)
		enShadowmap_Screen2_Far,			//シャドウマップ(スクリーン2、遠距離)
	};
	RenderTarget m_rts[enGBufferNum];	//G-Bufferのレンダーターゲットの配列

	Sprite m_deferredSprite;			//ディファードレンダリングの出力スプライト
};

